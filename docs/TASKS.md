# План развития проекта VENTMASH

Задачи разбиты по направлениям: база данных, бэкенд, фронтенд, поиск, аналитика (Яндекс.Метрика), документация.

---

## 1. База данных

### 1.1 Выбор и настройка СУБД
- [ ] Выбрать СУБД: **PostgreSQL** (рекомендуется для продакшена) или **SQLite** (для MVP/учебного проекта).
- [ ] Добавить в проект: `requirements.txt` — `psycopg2-binary` (PostgreSQL) или использовать встроенный `sqlite3`.
- [ ] Создать конфиг подключения (переменные окружения: `DATABASE_URL`, `.env` + `python-dotenv`).
- [ ] Написать скрипт инициализации БД: создание таблиц при первом запуске.

### 1.2 Схема данных
- [ ] Таблица **products**: `id`, `number`, `type`, `model`, `size`, `diameter`, `airflow_min`, `airflow_max`, `pressure_min`, `pressure_max`, `power`, `noise_level`, `price`, `created_at`, `updated_at`.
- [ ] При необходимости: таблицы **categories**, **manufacturers**, **product_attributes** (гибкие характеристики).
- [ ] Миграции: зафиксировать версии схемы (например, через Alembic или простые SQL-скрипты).

### 1.3 Перенос данных из CSV в БД
- [ ] Скрипт загрузки/импорта: читать `fans_data.csv` и вставлять строки в БД (с нормализацией чисел и диапазонов).
- [ ] Команда или эндпоинт для повторного импорта (например, `python manage.py load_csv` или `POST /api/admin/import-csv`).
- [ ] При старте приложения: проверять наличие данных в БД; при пустой БД — автоматический импорт из CSV (опционально).

---

## 2. Бэкенд (Python / Flask)

### 2.1 Работа с БД
- [ ] Заменить хранение «в памяти» (CSV при старте) на запросы к БД.
- [ ] Подключение к БД при старте приложения; пул соединений или один connection per request.
- [ ] Репозиторий/сервис для продуктов: выборка списка с фильтрами, выборка по `id`/модели.

### 2.2 API
- [ ] **GET /api/products** — оставить фильтры (тип, диаметр, цена, мощность, расход, давление, шум), сортировку по цене (asc/desc). Брать данные из БД.
- [ ] **GET /api/products/:id** — один товар по `id` или slug модели; данные из БД.
- [ ] Пагинация: параметры `page`, `per_page` (или `limit`/`offset`); в ответе — метаданные (total, page, per_page).
- [ ] **GET /api/filters** (опционально): уникальные значения для фильтров (типы, диаметры, диапазоны цен) — для быстрой подстановки в селекты на фронте.

### 2.3 Поиск и алгоритмы
- [ ] Полнотекстовый поиск по полям: модель, тип, типоразмер (при использовании PostgreSQL — `ILIKE` или `pg_trgm` / full-text search).
- [ ] Нормализация запроса: обрезка пробелов, приведение к нижнему регистру; разбиение по словам для поиска по нескольким токенам.
- [ ] Ранжирование: приоритет совпадения в `model`, затем в `type`, затем в `size`; при равенстве — сортировка по цене/популярности (если появятся просмотры).
- [ ] Фильтры по диапазонам: корректная обработка `airflow` и `pressure` (min/max в БД), учёт пересечения интервалов.

### 2.4 Безопасность и админка (опционально)
- [ ] Валидация и санитизация входных параметров (лимиты на `per_page`, экранирование для SQL).
- [ ] При необходимости: простая админка (Flask-Admin или свой CRUD) для редактирования товаров в БД.

---

## 3. Фронтенд

### 3.1 Яндекс.Метрика (трекер)
- [ ] Зарегистрировать счётчик на [metrika.yandex.ru](https://metrika.yandex.ru), получить **номер счётчика** (ID).
- [ ] Подключить скрипт Метрики во все страницы: вставить код счётчика в `index.html` и `product.html` (в `<head>` или перед `</body>`), подставить свой ID.
- [ ] Настроить цели (опционально): просмотр карточки товара, клик «Подробнее», отправка формы фильтров — через `ym(XXXXX, 'reachGoal', 'goal_name')` в `script.js`.
- [ ] Убедиться, что счётчик загружается по HTTPS и не блокируется при строгих настройках приватности (информирование в политике конфиденциальности, если нужно).

### 3.2 Улучшение UI/UX
- [ ] Адаптивная вёрстка: проверить каталог и карточку товара на мобильных и планшетах; при необходимости доработать сетку и размеры кнопок.
- [ ] Загрузка и скелетоны: показывать скелетон карточек или спиннер во время загрузки списка товаров и страницы товара.
- [ ] Обработка ошибок: понятные сообщения при ошибке сети или 404 (например, «Товар не найден» с кнопкой «В каталог»).
- [ ] Хлебные крошки: на странице товара — «Каталог → Модель X».
- [ ] Удобство фильтров: сброс фильтров одной кнопкой; сохранение выбранных фильтров в URL (query params), чтобы можно было поделиться ссылкой на «отфильтрованный» каталог.
- [ ] Пагинация или «Показать ещё» на странице каталога при большом числе товаров.

### 3.3 Визуальные улучшения
- [ ] Плейсхолдеры изображений: единый стиль (иконка вентилятора или логотип) или подгрузка реальных фото по URL из БД/CSV, если появятся поля с картинками.
- [ ] Карточки товаров: акцент на ключевых параметрах (мощность, расход, цена); hover-эффекты уже в стиле Яндекса — усилить при необходимости.
- [ ] Шрифты: подключить один системный или веб-шрифт (например, «YS Text» от Яндекса или Inter) для единообразия.
- [ ] Контраст и доступность: проверить соотношение цветов текста и фона (WCAG AA), размер кликабельных областей.

---

## 4. Поиск и функционал (общее)

### 4.1 Алгоритмы поиска
- [ ] Бэкенд: реализовать поиск по нескольким полям с приоритетами (см. п. 2.3).
- [ ] Фронтенд: поле поиска с debounce (например, 300 ms), чтобы не слать запрос на каждый символ; показывать подсказки (опционально).
- [ ] Учёт морфологии: при использовании PostgreSQL — расширение для стемминга/морфологии (русский язык), чтобы «вентилятор» и «вентиляторы» находились вместе.

### 4.2 Дополнительный функционал
- [ ] Избранное: сохранять выбранные товары в `localStorage` и показывать их на отдельной «мини-странице» или в шапке (иконка «Избранное» с счётчиком).
- [ ] Сравнение товаров: выбор 2–4 товаров и страница сравнения (таблица характеристик).
- [ ] Экспорт: кнопка «Скачать каталог» (CSV/Excel) по текущему набору фильтров (бэкенд отдаёт файл, фронт только запрашивает).

---

## 5. Документация

### 5.1 README проекта
- [ ] Описание проекта: цель (учебный B2B каталог), стек (Python, Flask, БД, Bootstrap, Яндекс.Метрика).
- [ ] Требования: Python 3.x, установка зависимостей, переменные окружения (`.env.example`).
- [ ] Запуск: создание venv, установка пакетов, миграции/импорт CSV, запуск сервера (и отдельно — как запускать фронт в dev, если будет сборка).
- [ ] Основные команды: `./run.sh`, `python load_csv.py`, и т.д.

### 5.2 API
- [ ] Документация по эндпоинтам: метод, URL, параметры запроса, пример ответа, коды ошибок.
- [ ] Оформить в виде `docs/API.md` или подключить Swagger/OpenAPI (например, flasgger) и описать эндпоинты там.

### 5.3 Развёртывание и конфигурация
- [ ] Пример `.env.example`: `DATABASE_URL`, `SECRET_KEY`, `YANDEX_METRIKA_ID`, порт.
- [ ] Краткая инструкция по деплою (например, на одном сервере: gunicorn + nginx, запуск из systemd).

### 5.4 Пользовательская документация (опционально)
- [ ] Как пользоваться каталогом: фильтры, сортировка, переход в карточку товара — короткая справка для преподавателя/заказчика.

---

## 6. Порядок выполнения (рекомендуемый)

1. **База данных**: выбор СУБД, схема, миграция данных из CSV, переход бэкенда на БД.
2. **Бэкенд**: доработка API (пагинация, фильтры из БД), улучшение алгоритмов поиска.
3. **Яндекс.Метрика**: подключение счётчика и при необходимости целей.
4. **Фронтенд**: скелетоны, обработка ошибок, сохранение фильтров в URL, визуальные и UX-улучшения.
5. **Документация**: README, API.md, .env.example.

После этого при необходимости: избранное, сравнение, экспорт, админка.

---

## Краткая сводка по ролям

| Направление   | Задачи |
|---------------|--------|
| **Backend**   | БД (схема, миграции, импорт CSV), API с пагинацией и фильтрами, полнотекстовый/умный поиск, валидация, опционально админка. |
| **Frontend**  | Подключение Яндекс.Метрики, скелетоны/загрузка, ошибки, хлебные крошки, фильтры в URL, пагинация/«Показать ещё», визуальные правки, избранное/сравнение при необходимости. |
| **Поиск**     | Бэкенд: многополевой поиск с приоритетами, нормализация, морфология (если PostgreSQL). Фронт: debounce, подсказки. |
| **Документация** | README, API.md, .env.example, инструкция по запуску и деплою. |
